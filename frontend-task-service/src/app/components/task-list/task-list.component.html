<h1>Gestor de tareas</h1>
<button (click)="toggleForm()">
    {{ showForm ? 'Cancelar' : 'Crear Nueva Tarea' }}
</button>

<div *ngIf="showForm" style="margin-top: 20px;">
    <h2>Crear Tarea</h2>
    <label>Título: <input type="text" [(ngModel)]="newTask.title"></label><br>
    <label>Descripción: <input type="text" [(ngModel)]="newTask.description"></label><br>
    <label>Fecha de Vencimiento:
        <input type="datetime-local" [ngModel]="newTask.dueDate | date:'yyyy-MM-ddTHH:mm'" (ngModelChange)="onDueDateChange($event)">
    </label><br>
    <label>Estado:
        <select [(ngModel)]="newTask.status">
            <option *ngFor="let status of taskStatuses" [ngValue]="status">{{ status }}</option>
        </select>
    </label><br>
    <label>Asignado a: <input type="text" [(ngModel)]="newTask.assignedTo"></label><br>
    <button (click)="createTask()">Crear Tarea</button>
</div>
<br>
<br>

<!-- Mensaje de Éxito -->
<div *ngIf="successMessage" class="success-message">
    <p>{{ successMessage }}</p>
    <button (click)="clearSuccessMessage()">Cerrar</button>
</div>
<!-- Mensaje de Error -->
<div *ngIf="errorMessageCrear" class="error-message">
    <p>{{ errorMessageCrear }}</p>
    <button (click)="clearErrorMessage()">Cerrar</button>
</div>

<h2>Lista de Tareas</h2>
<label for="status">Filtrar por Estado:</label>
<select id="status" [(ngModel)]="statusFilter">
    <option value="">Todos</option>  <!-- Si es vacío, debería mostrar todo -->
    <option *ngFor="let status of taskStatuses" [value]="status">{{ status }}</option>
</select>
<button (click)="filterTasks()">Filtrar</button>

<table class="task-table">
    <thead>
        <tr>
            <th>Id</th>
            <th>Título</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Fecha Límite</th>
            <th>Asignado a</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let task of tasks">
            <td>{{ task.id }}</td>
            <td>{{ task.title }}</td>
            <td>{{ task.description }}</td>
            <td><span class="status-badge" [ngClass]="'status-' + task.status">
                {{ task.status }}
            </span></td>
            <td>
                <ng-container *ngIf="task.dueDate">
                    {{ task.dueDate | date:'medium' }}
                </ng-container>
            </td>
            <td>{{ task.assignedTo || 'Sin asignar' }}</td>
            <td>
                <button (click)="editTask(task)" class="edit-button">Editar</button>
                <button (click)="deleteTask(task.id)" class="delete-button">Eliminar</button><br><br>
                
                <input type="text" [(ngModel)]="assignedUser" placeholder="Nombre de usuario">
                <button (click)="assignTask(task.id, assignedUser)" class="assign-button">Asignar</button>
            </td>
        </tr>
        <tr *ngIf="tasks.length === 0">
            <td colspan="8" style="text-align: center;">No hay tareas que mostrar.</td>
         </tr>
    </tbody>
</table>

<div *ngIf="editingTask" style="margin-top: 20px;">
    <h2>Editar Tarea</h2>
    <label>Título: <input type="text" [(ngModel)]="editingTask.title"></label><br>
    <label>Descripción: <input type="text" [(ngModel)]="editingTask.description"></label><br>
    <label>Fecha de Vencimiento:
        <input type="datetime-local" [ngModel]="editingTask.dueDate | date:'yyyy-MM-ddTHH:mm'" (ngModelChange)="onEditDateChange($event)" />
    </label><br>
    <label>Estado:
        <select [(ngModel)]="editingTask.status">
            <option *ngFor="let status of taskStatuses" [ngValue]="status">{{ status }}</option>
        </select>
    </label><br>
    <label>Asignado a: <input type="text" [(ngModel)]="editingTask.assignedTo"></label><br>
    
    <!-- Botón de Actualizar -->
    <button (click)="updateTask()" class="btn btn-success">Actualizar Tarea</button>

    <!-- Botón de Cancelar -->
    <button (click)="cancelEdit()" class="btn btn-danger" style="margin-left: 10px;">Cancelar</button>
</div>

<!-- Mensaje de Error -->
<div *ngIf="errorMessageEditar" class="error-message">
    <p>{{ errorMessageEditar }}</p>
    <button (click)="clearErrorMessage()">Cerrar</button>
</div>

<!-- Buscar por ID -->
<div class="card">
    <label for="taskId">Buscar Tarea por ID:</label>
    <input type="number" id="taskId" #taskIdInput>
    <button (click)="getTaskById(taskIdInput.valueAsNumber, taskIdInput)">Buscar</button>


    <!-- Mostrar tarea obtenida por ID -->
    <div *ngIf="selectedTask">
        <h3>Tarea Obtenida por ID</h3>
        <p><strong>ID:</strong> {{ selectedTask.id }}</p>
        <p><strong>Título:</strong> {{ selectedTask.title }}</p>
        <p><strong>Descripción:</strong> {{ selectedTask.description }}</p>
        <p><strong>Estado:</strong> {{ selectedTask.status }}</p>
        <p><strong>Fecha Límite:</strong> {{ selectedTask.dueDate | date: 'shortDate' }}</p>
        <p><strong>Asignado a:</strong> {{ selectedTask.assignedTo || 'Sin asignar' }}</p>
        <!-- Botón de Cancelar -->
        <button (click)="clearTaskByID()" class="btn btn-danger" style="margin-left: 10px;">Limpiar</button>
    </div>
</div>

<div>
     <br>
</div>

<div *ngIf="errorMessageID" class="error-message">
    <p>{{ errorMessageID }}</p>
    <button (click)="clearErrorMessage()">Cerrar</button>
</div>
